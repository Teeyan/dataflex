<!DOCTYPE html>
<html>
    <head>
        <title>Flex!</title>
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    </head>
    
    <body>
     <div id="uploadData" top= 100%>
         <center>
             <form>
                 <input name="fileUpload" type= "file"> 
             </form>
         
            <button type="submit" class="btn btn-primary" id="upload">Upload!</button>
         </center>
    </div>     
    <div id="data">                
            <div class="split left">
              <div class="search">
                  <input type="text" id="myInput" onkeyup="myFunction()" placeholder="Search for names.." title="Type in a name">

                 <div id="attributes">
                    <ul id="myMenu">
                          <li><a href="#">HTML</a></li>
                          <li><a href="#">CSS</a></li>
                          <li><a href="#">JavaScript</a></li>
                          <li><a href="#">PHP</a></li>
                          <li><a href="#">Python</a></li>
                          <li><a href="#">jQuery</a></li>
                          <li><a href="#">SQL</a></li>
                          <li><a href="#">Bootstrap</a></li>
                          <li><a href="#">Node.js</a></li>
                        <!---- temp dont use REact Code Here-->
                        </ul>
                  </div>
              </div>
            </div>
        
            k<div class="split right">
              <div class="centered">
                  <div id = "featureData">
                    <!---REact Code---->  
                      
                  <div class="newBTN">
                  <button type="submit" class="btn btn-primary" id="newupload">New Search</button>
                </div>
              </div>
            </div>


        </div>
        </div>
                <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <script>
        $(document).ready(function(){
            $("#uploadData").show();
            $("#data").hide(); 
        })
        $("#upload").on("click",function(){
            $("#uploadData").hide();
            $("#data").show();
        })
        $("#newupload").on("click",function(){
            $("#uploadData").show();
            $("#data").hide();
        })
        var input, filter, ul, li, a, i;
          input = document.getElementById("mySearch");
          filter = input.value.toUpperCase();
          ul = document.getElementById("myMenu");
          li = ul.getElementsByTagName("li");
        function myFunction() {
          var input, filter, ul, li, a, i;
          input = document.getElementById("mySearch");
          filter = input.value.toUpperCase();
          ul = document.getElementById("myMenu");
          li = ul.getElementsByTagName("li");
          for (i = 0; i < li.length; i++) {
            a = li[i].getElementsByTagName("a")[0];
            if (a.innerHTML.toUpperCase().indexOf(filter) > -1) {
              li[i].style.display = "";
            } else {
              li[i].style.display = "none";
            }
          }
        }
        </script>


        <!-- React Components -->
        <script>
          import React, { Component } from 'react';
          import {
            PopupboxManager,
            PopupboxContainer
          } from 'react-popupbox';
          import './App.css';

          /**
          * Attribute Entry Component:
          *   Exist in list on the right side of the screen
          */
          class Entry extends React.Component {
            constructor(props) {
              super(props);
              this.state = {
                mean: 0,
                mode: 0,
                median: 0,
                variance: 0,
                num_null: 0
              }

              this.handleNormalize = this.handleNormalize.bind(this)
              this.handleNull = this.handleNull.bind(this)
              this.viewData = this.viewData.bind(this)
            }

            componentDidMount() {
              fetch('localhost:8000/meta?attr=' + this.props.value)
              .then(results => {
                return results.json()
              }).then(data => {
                this.setState({
                  mean: data.mean,
                  mode: data.mode,
                  median: data.median,
                  variance: data.variance,
                  num_null: data.num_null
                })
              })
            }

            /**
            * Normalize this entry
            */
            handleNormalize() {
              // Normalize
              fetch('localhost:8000/normalize?attr=' + this.props.value)

              // Fetch the new metadata
              fetch('localhost:8000/meta?attr=' + this.props.value)
              .then(results => {
                return results.json()
              }).then(data => {
                this.setState({
                  mean: data.mean,
                  mode: data.mode,
                  median: data.median,
                  variance: data.variance,
                  num_null: data.num_null
                })
              })
            }

            /**
            * Fill in Null for this entry
            */
            handleNull {
              // Fill in Null based on value
              fetch('localhost:8000/fill?attr=' + this.props.value + '&method=mean')

              // Fetch the new metadata
              fetch('localhost:8000/meta?attr=' + this.props.value)
              .then(results => {
                return results.json()
              }).then(data => {
                this.setState({
                  mean: data.mean,
                  mode: data.mode,
                  median: data.median,
                  variance: data.variance,
                  num_null: data.num_null
                })
              })
            }

            /**
            * View the data points for this entry
            */ 
            viewData {
              // put in a popup or some shit idk
              fetch('localhost:8000/view?attr=' + this.props.value)
              .then(results => {
                return results.json()
              }).then(data => {
                const values = data[this.props.value]
                const content = {
                  <div>
                    {values}
                  </div>
                }
                PopupboxManager.open({content})
              })
            }


            render() {
              return(

              );
            }
          }

           /**
           * AttrList Component:
           *  Main right side of the screen, stores the primary state for the Entry components
           */
          class AttrList extends React.Component {
            constructor(props) {
              super(props);
              this.state = {
                entries = new Set()
              };

              this.additem = this.addItem.bind(this);
              this.removeItem = this.removeItem.bind(this);
            }

            // Add an Entry to the list
            addItem(attr) {
              this.setState(({entries}) => ({
                entries: new Set(entries).add(attr)
              }));
            }

            // Remove entry from the list
            removeItem(attr) {
              this.setState(({entries}) => {
                const newEntries = new Set(entries);
                newEntries.delete(attr);

                return {
                  entries: newEntries
                };
              });
            }

            // Render the Attribute Entries individually as controlled components
            render() {
              const attrList = Array.from(this.state.entries).map((attr) =>
                <Entry key={attr} value={attr}>
              );
              
              return (
                <ul>
                  {attrList}
                </ul>
              )
            }
          }

          /**
          * SearchList left side of the screen containing search entry
          */
          class SearchList extends React.Component {
            constructor(props) {
              super(props);
              this.state = {
                attrList: []
              };
              this.handler = this.handler.bind(this);
            }

            componentDidMount() {
              fetch("localhost:8000/init?upload=" + this.props.upload + "&header=" + this.props.header)
              .then(results => {
                return results.json();
              }).then(data => {
                this.setState({attrList: data})
              });
            }

            handler(attr) {
              this.setState(({attrList}) => {
                const newList = new Set(attrList);
                newList.delete(attr);
                return {attrList.Array.from(newList)}
              });
            }

            render() {
              const attributeList = ths.state.attrList.map((attr) =>
                <SearchEntry key={attr} value={attr} handler={this.handler}>
              );
              return (
                <ul>
                  {attributeList}
                </ul>
              );
            }
          }

          /**
          * SearchEntry left side of the screen
          */
          class SearchEntry extends React.Component {
            constructor(props) {
              super(props);
              this.state = {
                isChecked: false;
              }
              this.removeItem = this.removeItem.bind(this);
              this.checkItem = this.checkItem.bind(this);
            }

            checkItem() {
              if(this.state.isChecked) {
                AttrList.removeItem(this.props.value);
                this.setState({isChecked: false});
              }
              else {
                this.setState({isChecked: true});
                AttrList.addItem(this.props.value);
              }
            }

            removeItem() {
              if(this.state.isChecked) {
                AttrList.removeItem(this.props.value);
              }
              this.props.handler(this.props.value);
            }

            render() {

            }
          }
        </script>
        
    </body>
</html>  